<!DOCTYPE html>
<html>
	<head>
		<title>Attempt 1</title>
		<link href="https://fonts.googleapis.com/css?family=VT323" rel="stylesheet">
		<style>
			html {
				align-items: center;
				background: #000;
				display: flex;
				height: 100%;
				justify-content: center;
			}
			canvas, div {
				background: #000;
				color: #3F0;
			}
			div {
				font-family: VT323;
				font-size: 6vh;
				position: fixed;
				left: 0;
				top: 0;
				padding: 5vh 5vw;
				width: 90vw;
				height: 90vh;
				z-index: -1;
			}
			canvas {
				border: solid 3px #3F0;
				z-index: 1;
			}
		</style>
		<script name='noise' src='perlin.js'></script>
		<script name='Vector'>
			"use strict";
			class Vector {
				// Constructor
				constructor(x = 0, y = 0, z = null) {
					this.x = x;
					this.y = y;
					this.z = z;
				}
				// To 2D
				to2D(w, h) {
					if(this.z == null)
						return this;
					return new Vector(w / 2 + this.x * this.z, h / 2 - this.y * this.z);
				}
				// Scale
				getScale() {
					return (this.z / 5);
				}
			}
			// Store grid of points
			const points = [],
				length = 12,
				width = 96;
			
			// Set seed
			noise.seed(Math.floor(Math.random() * 10e9));
			
			// Generate points with Simplex 2D Noise
			for(let x = -width/2; x < width/2; x += 0.5)
				for(let z = 1; z < length; z += 0.125)
					points.push(new Vector(x, 10 + 2 * Math.cos(noise.simplex2(x / 8, z / 2)), z));
			
			// Use WebGL and Canvas
			const canvas = document.createElement('canvas'),
				gl = canvas.getContext('webgl');
			
			// With these dimensions
			canvas.width = 1280;
			canvas.height = 480;
			
			// Log to the screen for some reason
			function log(text, isHTML = false, clear = false) {
				let i = 'inner' + (isHTML ? 'HTML' : 'Text'),
					newLine = isHTML ? '<br />' : '\n';
				document.querySelector('div')[i] = 
					text + newLine + 
					(clear ? '' : document.querySelector('div')[i]);
			}
			
			// I commented out FPS Code 
			// I don't care how fast it works 
			// I care that it works 
			
			// let frames = 0,
			// 	fps = 0,
			// 	lastUpdate = new Date().getTime();
			
			function doFrame() {
				// let now = new Date().getTime();
				// frames++;
				// if(lastUpdate + 999 < now) {
				// 	lastUpdate = now;
				// 	fps = frames;
				// 	frames = 0;
				// 	log(fps + ' fps', true, true);
				// }
				gl.viewport(0, 0, canvas.width, canvas.height);
				gl.clearColor(0.0, 0.0, 0.0, 0.0);
				gl.clear(gl.COLOR_BUFFER_BIT);
				for(let pid = 0; pid < points.length; pid++) {
					let p = points[pid],
						p2d = p.to2D(canvas.width, canvas.height),
						s = 1;
					gl.clearColor(0.1, 1.0, 0.0, 1.0);
					gl.scissor(p2d.x - s/2, p2d.y - s/2, s, s);
					gl.clear(gl.COLOR_BUFFER_BIT);
					p.y = 10 + 2.5 * Math.cos(noise.simplex3(p.x / 8, p.z / 2, new Date().getTime()/5000));
				}
				requestAnimationFrame(doFrame);
			}
			
			addEventListener('DOMContentLoaded', e => {
				document.body.appendChild(document.createElement('div'));
				document.body.appendChild(canvas);
				gl.enable(gl.SCISSOR_TEST);
				doFrame();
			});
		</script>
	</head>
</html>
